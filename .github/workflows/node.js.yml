// update_prices_30_percent.js
import { createClient } from '@supabase/supabase-js';
import * as dotenv from 'dotenv';

// Load environment variables
dotenv.config();

const supabaseUrl = process.env.VITE_SUPABASE_URL;
const supabaseKey = process.env.VITE_SUPABASE_ANON_KEY;

const supabase = createClient(supabaseUrl, supabaseKey);

async function updateAllPrices() {
  try {
    console.log('üîÑ Starting price update...');
    
    // Fetch all menu items
    const { data: menuItems, error: fetchError } = await supabase
      .from('menu_items')
      .select('*');
    
    if (fetchError) {
      console.error('‚ùå Error fetching menu items:', fetchError);
      return;
    }
    
    console.log(`üìä Found ${menuItems.length} menu items`);
    
    // Update each item with 30% price increase
    let updated = 0;
    let failed = 0;
    
    for (const item of menuItems) {
      const oldPrice = parseFloat(item.price);
      const newPrice = (oldPrice * 1.30).toFixed(2); // 30% increase
      
      const { error: updateError } = await supabase
        .from('menu_items')
        .update({ price: newPrice })
        .eq('id', item.id);
      
      if (updateError) {
        console.error(`‚ùå Failed to update ${item.name}:`, updateError);
        failed++;
      } else {
        console.log(`‚úÖ Updated "${item.name}": ‚Çπ${oldPrice} ‚Üí ‚Çπ${newPrice}`);
        updated++;
      }
    }
    
    console.log(`\n‚ú® Update complete!`);
    console.log(`   ‚úÖ Updated: ${updated}`);
    console.log(`   ‚ùå Failed: ${failed}`);
    
  } catch (error) {
    console.error('‚ùå Script error:', error);
  }
}

// Run the update
updateAllPrices();
